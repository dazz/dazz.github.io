<!doctype html><html lang=en-us><head><meta name=robots content="noai, noimageai"><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=7"><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=icon href=/logo.svg type=image/svg+xml><title>Build and push docker images to ghcr.io with GitHub Actions &ndash;
DazzLog
</title><link href=/symbols-nerd-font/symbols-nerd-font.css rel=stylesheet><link href=/jetbrains-mono/jetbrains-mono.css rel=stylesheet><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><link type=text/css rel=stylesheet href=https://blog.dazzlog.de/css/styles.2e533e5a184f37d512ab5427df4edc7a2ff7decde458c8194f85e2ccf06b69c65854c3557f23521f79e085372de199dbb0a5951ba09caac12eb8c54ba36ebeae.css integrity="sha512-LlM+WhhPN9USq1Qn307cei/33s3kWMgZT4XizPBracZYVMNVfyNSH3nghTct4ZnbsKWVG6CcqsEuuMVLo26+rg=="><link type=text/css rel=stylesheet href=https://blog.dazzlog.de/css/admonition.b96f1a7df9789120ac45fb9c21858b542016295476d737d858978eb00a2922cf562bd9f9e33cf74d71f40248259678c1ba16082bb0ac996b715a938a50b3bec6.css integrity="sha512-uW8affl4kSCsRfucIYWLVCAWKVR21zfYWJeOsAopIs9WK9n54zz3TXH0AkgllnjBuhYIK7CsmWtxWpOKULO+xg=="><link type=text/css rel=stylesheet href=https://blog.dazzlog.de/css/custom.e3414e6d4a952c3fc57a01061a8e1ee0d58131bb73947c6ab03915d712730d0040c9f603dd985fb9e6e3bce89c86736f98628355433e35b6a3a3e2da7e79d76f.css integrity="sha512-40FObUqVLD/FegEGGo4e4NWBMbtzlHxqsDkV1xJzDQBAyfYD3ZhfuebjvOichnNvmGKDVUM+Nbajo+LafnnXbw=="><meta name=author content="dazz | Anne-Julia Seitz"><meta name=keywords content='cd,docker,github,github-actions,github-packages'><meta name=description content='r project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. Actions are basically hooks that can start CI/DC workflows on repository events.</p>
<p>GitHub actions can be used to build and push images to GitHub’s Container Registry which are reachable under <a href="https://ghcr.io">https://ghcr.io</a> which is part of the package registry. The package registry is not only for docker images, it can also host quite a few other kinds of packages. In this case we’ll focus on docker images.</p>'><meta property="og:site_name" content='DazzLog'><meta property="og:title" content="Build and push docker images to ghcr.io with GitHub Actions"><meta property="og:type" content="article"><meta property="article:author" content="dazz | Anne-Julia Seitz"><meta property="article:published_time" content='2022-12-28T00:25:38Z+0100'><meta property="article:tag" content="cd"><meta property="article:tag" content="docker"><meta property="article:tag" content="github"><meta property="article:tag" content="github-actions"><meta property="article:tag" content="github-packages"><meta property="og:url" content="https://blog.dazzlog.de/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions/"><meta property="og:image" content="https://blog.dazzlog.de/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions//dockergithub.png"><meta property="og:description" content="<p>When you host your project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. Actio"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content='blog.dazzlog.de'><meta property="twitter:url" content="https://blog.dazzlog.de/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions/"><meta name=twitter:title content="Build and push docker images to ghcr.io with GitHub Actions"><meta name=twitter:image content="https://blog.dazzlog.de/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions//dockergithub.png"><meta name=twitter:description content="<p>When you host your project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. Actio"><link rel=manifest href=/manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=/><img src=/logo.svg alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=/>DazzLog</a></h1><label id=hamburger-menu for=main-nav-toggler>&#xf85b;</label></div><div id=wide_nav><nav><input type=checkbox id=main-nav-toggler><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/talks>Talks</a></li><li><a href=/about>About</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<span class=nerdlink onclick=newSearch()>&#xf002;</span></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search/?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=/index.xml>&#xf09e;
<span>RSS
</span></a><a rel=noreferrer target=_blank class=nerdlink href=https://github.com/dazz>&#xf09b;
<span>GitHub
</span></a><a rel=me target=_blank class=nerdlink href=https://phpc.social/@dazz><svg class="pseudofont" xmlns:svg="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16"><path d="M7.4779094-.1598624e-5C5.5602384.0156984 3.7155894.2233384 2.6405814.7170384c0 0-2.13206093.9537-2.13206093 4.20766.0.74512-.01448 1.63603.0091 2.58084.07742 3.1821946.58336693 6.3183886 3.52553593 7.0971276 1.356568.359063 2.521335.434289 3.45936.382729 1.701085-.09431 2.6560206-.607063 2.6560206-.607063l-.05611-1.234252s-1.2156316.383272-2.5808476.33656c-1.352609-.04639-2.780561-.145832-2.999328-1.80651-.0202-.145872-.03031-.301902-.03031-.465714.0-1e-6 1.327834.324572 3.010574.40167 1.028943.0472 1.993827-.06028 2.9738766-.177218 1.879445-.224425 3.515901-1.382448 3.721577-2.4405646.32407-1.666815.297376-4.067605.297376-4.067605.0-3.25396-2.131943-4.20766-2.131943-4.20766C11.288476.2233384 9.4426784.0156784 7.5250084-.1598624e-5zM5.3076104 2.5424984c.798781.0 1.403595.30701 1.803551.92113l.388886.65181.388884-.65181c.399875-.61412 1.00469-.92113 1.803551-.92113.6903266.0 1.2465526.24267 1.6713186.71609.411755.47342.61677 1.11337.61677 1.91862v3.939988h-1.560986v-3.824218c0-.80613-.339166-1.21531-1.0176126-1.21531-.750129.0-1.126049.48533-1.126049 1.44509v2.09324h-1.551753v-2.09324c0-.95976-.376039-1.44509-1.126168-1.44509-.678446.0-1.017613.40918-1.017613 1.21531v3.824218h-1.560985v-3.939988c0-.80525.205053-1.4452.616889-1.91862.424685-.47342.980911-.71609 1.671317-.71609z"/></svg>
<span>Mastodon</span></a></div><div id=sidebar_nav><nav><input type=checkbox id=main-nav-toggler><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/talks>Talks</a></li><li><a href=/about>About</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>Build and push docker images to ghcr.io with GitHub Actions</h1><p class=date><span title=Date>󰃭 </span>2022-12-28</p><figure style=margin:0><img src=https://blog.dazzlog.de/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions//dockergithub.png alt></figure><div><p>When you host your project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. Actions are basically hooks that can start CI/DC workflows on repository events.</p><p>GitHub actions can be used to build and push images to GitHub’s Container Registry which are reachable under <a href=https://ghcr.io>https://ghcr.io</a> which is part of the package registry. The package registry is not only for docker images, it can also host quite a few other kinds of packages. In this case we’ll focus on docker images.</p><h2 id=prerequisites><strong>Prerequisites</strong>:</h2><ul><li>GitHub Repository</li><li>Basic Knowledge about GitHub actions syntax</li><li>Dockerfile</li></ul><h2 id=the-github-workflow>The GitHub Workflow</h2><p>I created a workflow in my repository under <code>.github/workflow/cd.md</code> and added the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Continuous Delivery
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f1fa8c>&#39;main&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f1fa8c>&#39;v*.*.*&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: Buid and push Docker image to GitHub Container registry
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>permissions</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>packages</span>: write
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>contents</span>: read
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Checkout the repository
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Docker Setup Buildx
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: docker/setup-buildx-action@v2.2.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Docker Login
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: docker/login-action@v2.1.0
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>registry</span>: ghcr.io
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>username</span>: ${{ github.actor }}
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>password</span>: ${{ secrets.GITHUB_TOKEN }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Build and push Docker images
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: docker/build-push-action@v3.2.0
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>REGISTRY</span>: ghcr.io
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>IMAGE_NAME</span>: ${{ github.repository }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>context</span>: .
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>file</span>: ./Dockerfile
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>target</span>: final
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>push</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>tags</span>: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest
</span></span></code></pre></div><h2 id=lets-go-through-the-important-parts>Let’s go through the important parts:</h2><p><strong>Permissions</strong>: Actions have access to the repo while running. We should always make sure by setting the permissions, that actions have the minimum access they require. See here: permissions for the <code>github_token</code></p><p><strong>Step 1–2: Checkout the code and Setup docker</strong></p><p><strong>Step 3: Login to GitHub Container Registry</strong>: This is where the interesting part starts. <code>github.actor</code> is the user that triggers the workflow. For password use <code>secrets.GITHUB_TOKEN</code> which is a temporary token which is automatically generated for this workflow. See here: publishing images to github-packages.</p><p><strong>Step 4: Build and push Docker images</strong>: If the registry that you want to push to belongs to an organization then you will need to add permissions to create packages. If it lives under your own handle you don’t need to configure anything more since you are the owner already and the <code>secrets.GITHUB_TOKEN</code> has all the permissions granted.</p><p>The action will consume the Dockerfile and build the image up to the target build step that you can define. In docker the repository where the image will be hosted is also part of the tag. Setting the image name to the repository name will create an image with the following tag: <code>ghcr.io/OWNER/IMAGE_NAME:latest</code></p><p>Read more here: pushing container images</p><h2 id=happy-shipping-o>Happy shipping \o/</h2></div></article><p class=articleTagsContainer><span> </span><strong>Tags:</strong>
<a href=/tags/cd/>#cd</a>
<a href=/tags/docker/>#docker</a>
<a href=/tags/github/>#github</a>
<a href=/tags/github-actions/>#github-actions</a>
<a href=/tags/github-packages/>#github-packages</a></p><a style=margin-bottom:24px;display:inline-block class=shareBtn onclick=openFediInstanceDialog()>Share on the Fediverse</a><div id=fediInstanceDialog><div class=bg onclick=closeFediInstanceDialog()></div><div class=dialog><h2>Enter your instance's address</h2><input id=fediInstanceInput placeholder='Eg. mastodon.social' type=text><div class=buttons><a class=shareBtn onclick=closeFediInstanceDialog()>Cancel</a>
<a class=shareBtn onclick=shareOnFedi()>Share</a></div></div></div><script>var articleTitle="Build and push docker images to ghcr.io with GitHub Actions",articleLink="https://blog.dazzlog.de/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions/",fediInstanceDialog=document.getElementById("fediInstanceDialog"),fediInstanceInput=document.getElementById("fediInstanceInput");function openFediInstanceDialog(){fediInstanceDialog.classList.add("open")}function closeFediInstanceDialog(){fediInstanceDialog.classList.remove("open")}function fixURL(e){return e.substr(0,8)=="https://"?e:e.substr(0,7)=="http://"?e:"https://"+e}function shareOnFedi(){let e=fediInstanceInput.value.trim();if(!e)return;e=fixURL(e),window.open(`${e}/share?text=${articleTitle}%20${articleLink}`,"__blank"),closeFediInstanceDialog()}</script><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><div id=ficurinia-cactus-comments></div><script>initComments({node:document.getElementById("ficurinia-cactus-comments"),defaultHomeserverUrl:"https://matrix.cactus.chat:8448",serverName:"cactus.chat",siteName:"dazzlog",commentSectionId:"16f5ed460c26090c806fa77c96a97a76"})</script><div class=relatedArticlesContainer><hr><h2>More posts like this</h2><div class=postlist><article class="card postlistitem"><div><h2><a href=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container/>Mastering Multi-Process Containers: Running PHP Applications with s6-overlay</a></h2><p class=date><span title=Date>󰃭 </span>2025-03-26
|
<span title=Tags> </span><a href=/tags/ci>#ci</a>
<a href=/tags/devops>#devops</a>
<a href=/tags/docker>#docker</a>
<a href=/tags/s6-overlay>#s6-overlay</a></p><a class=unstyledLink href=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container/><img src=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container//multi-process-container.webp alt></a><div class=articlePreview><p><h2 id=the-dockerized-development-setup>The Dockerized Development Setup</h2><p>Containerization has completely changed how we build and deploy PHP applications. With Docker, you can make sure that your production environment behaves just like your local setup, which means fewer surprises when you go live.</p><p>In this post, we&rsquo;re diving into running Symfony in a container that runs multiple processes using s6-overlay. We&rsquo;ll explain why having more than one process in a container can be important, how this idea is different from Docker&rsquo;s usual “one process per container” rule, and how s6-overlay makes it easier to run everything together.</p></p><p><a href=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container/>Continue reading </a></p></div></div><hr></article><article class="card postlistitem"><div><h2><a href=https://blog.dazzlog.de/posts/2024-12-06_s6-cli/>Manage s6-overlay setup with s6-cli</a></h2><p class=date><span title=Date>󰃭 </span>2024-12-06
|
<span title=Tags> </span><a href=/tags/ci>#ci</a>
<a href=/tags/devops>#devops</a>
<a href=/tags/docker>#docker</a>
<a href=/tags/s6-overlay>#s6-overlay</a></p><div class=articlePreview><p><p>I developed a small cli in golang to ease creating, validating and documenting services that s6 supervises.</p><ul><li>The repo: <a href=https://github.com/dazz/s6-cli>https://github.com/dazz/s6-cli</a></li><li>The docker image: <a href=https://hub.docker.com/repository/docker/hakindazz/s6-cli>https://hub.docker.com/repository/docker/hakindazz/s6-cli</a></li></ul><h2 id=usage>Usage</h2><p>You do not need to install anything, just execute the binary via docker</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm hakindazz/s6-cli <span style=color:#8be9fd;font-style:italic>help</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMANDS:
</span></span><span style=display:flex><span>   create, c   create a service
</span></span><span style=display:flex><span>   remove, rm  remove a service
</span></span><span style=display:flex><span>   lint, l     lint directories and files
</span></span><span style=display:flex><span>   mermaid, m  document s6 service dependencies in mermaid syntax
</span></span><span style=display:flex><span>   help, h     Shows a list of commands or <span style=color:#8be9fd;font-style:italic>help</span> <span style=color:#ff79c6>for</span> one <span style=color:#8be9fd;font-style:italic>command</span>
</span></span></code></pre></div><h2 id=create-a-service-with-s6-cli>Create a service with s6-cli</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm -v ./:/etc/s6-overlay hakindazz/s6-cli create oneshot init-dependencies
</span></span></code></pre></div><p>Here is the file / directory structure it creates:</p></p><p><a href=https://blog.dazzlog.de/posts/2024-12-06_s6-cli/>Continue reading </a></p></div></div><hr></article></div></div></main><footer><hr><div class=footerColumns><ul class=notlist><li><strong>this.site</strong></li><li><a target=_blank href=/about>about</a></li><li><a target=_blank href=/impressum>impressum</a></li></ul><ul class=notlist><li><strong>self.dazz</strong></li><li><a target=_blank href=https://github.com/dazz>my GitHub</a></li><li><a target=_blank href=https://medium.com/@dazs>on Medium</a></li><li><a target=_blank href=https://speakerdeck.com/dazz/>Speaker Deck</a></li></ul><ul class=notlist><li><strong>here.links</strong></li><li><a target=_blank href=https://c-base.org>c-base</a></li></ul></div><p><small>2025 &copy; dazz - <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></p><p><small><a href=https://gitlab.com/gabmus/hugo-ficurinia>Ficurinia theme</a> for <a href=https://gohugo.io>Hugo</a> by <a href=https://gabmus.org>Gabriele Musco</a>. Licensed under <a href=https://www.gnu.org/licenses/agpl-3.0.html>GNU AGPLv3</a>.</small></p></footer></div></div></div></body></html>