<!doctype html><html lang=en-us><head><script>location.host!=new URL("https://dazz.github.io/").host&&(location.href="https://dazz.github.io/")</script><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=7"><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=icon href=/logo.svg type=image/svg+xml><title>Build and push docker images to ghcr.io with GitHub Actions &ndash;
Dazz's Dev Log</title><link href=/symbols-nerd-font/symbols-nerd-font.css rel=stylesheet integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="><link href=/jetbrains-mono/jetbrains-mono.css rel=stylesheet integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><link type=text/css rel=stylesheet href=https://dazz.github.io/css/styles.abbd6311bb4b6ca58f8e7398140529245ae0f6428b759fcd830742eee2619eabb900ba9914a9affb82aa9a16a9b9ea727bb315315a976a0db0e7513a5f12c504.css integrity="sha512-q71jEbtLbKWPjnOYFAUpJFrg9kKLdZ/NgwdC7uJhnqu5ALqZFKmv+4Kqmhapuepye7MVMVqXag2w51E6XxLFBA=="><meta name=author content="dazz | Anne-Julia Seitz"><meta name=keywords content="cd,docker,github,github-actions,github-packages"><meta name=description content="roject code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. It’s basically hooks that can start CI/DC workflows on repository events."><meta property="og:site_name" content="Dazz's Dev Log"><meta property="og:title" content="Build and push docker images to ghcr.io with GitHub Actions"><meta property="og:type" content="article"><meta property="article:author" content="dazz | Anne-Julia Seitz"><meta property="article:published_time" content="2022-12-28T00:25:38Z+0100"><meta property="article:tag" content="cd"><meta property="article:tag" content="docker"><meta property="article:tag" content="github"><meta property="article:tag" content="github-actions"><meta property="article:tag" content="github-packages"><meta property="og:url" content="https://dazz.github.io/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions/"><meta property="og:image" content="https://dazz.github.io/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions//dockergithub.png"><meta property="og:description" content="When you host your project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. It’s bas"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="dazz.github.io"><meta property="twitter:url" content="https://dazz.github.io/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions/"><meta name=twitter:title content="Build and push docker images to ghcr.io with GitHub Actions"><meta name=twitter:image content="https://dazz.github.io/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions//dockergithub.png"><meta name=twitter:description content="When you host your project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. It’s bas"><link rel=manifest href=/manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=/><img src=/logo.svg alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=/>Dazz's Dev Log</a></h1></div><div id=wide_nav><nav><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<a class=nerdlink onclick=newSearch()>&#xf002;</a></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=/index.xml>&#xf09e;
<span>RSS</span></a>
<a rel=noreferrer target=_blank class=nerdlink href=https://github.com/dazz>&#xf09b;
<span>GitHub</span></a></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>Build and push docker images to ghcr.io with GitHub Actions</h1><p class=date><span title=Date></span>
2022-12-28</p><figure style=margin:0><img src=https://dazz.github.io/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions//dockergithub.png alt></figure><div><p>When you host your project code on GitHub and want to release it as a docker image for deployment or just publish it, the way to go are GitHub actions. It’s basically hooks that can start CI/DC workflows on repository events.</p><p>GitHub actions can be used to build and push images to GitHubs Container Registry which are reachable under <a href=https://ghcr.io>https://ghcr.io</a> which is part of the package registry. The package registry is not only for docker images, it can also host quite a few other kinds of packages. In this case we’ll focus on docker images.</p><h2 id=prerequisites><strong>Prerequisites</strong>:</h2><ul><li>GitHub Repository</li><li>Basic Knowledge about GitHub actions syntax</li><li>Dockerfile</li></ul><h2 id=the-github-workflow>The GitHub Workflow</h2><p>I created a workflow in my repository under <code>.github/workflow/cd.md</code> and added the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>name</span>: Continuous Delivery
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>branches</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f1fa8c>&#39;main&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f1fa8c>&#39;v*.*.*&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>name</span>: Buid and push Docker image to GitHub Container registry
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>permissions</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>packages</span>: write
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>contents</span>: read
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Checkout the repository
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Docker Setup Buildx
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: docker/setup-buildx-action@v2.2.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Docker Login
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: docker/login-action@v2.1.0
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>registry</span>: ghcr.io
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>username</span>: ${{ github.actor }}
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>password</span>: ${{ secrets.GITHUB_TOKEN }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>name</span>: Build and push Docker images
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: docker/build-push-action@v3.2.0
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>REGISTRY</span>: ghcr.io
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>IMAGE_NAME</span>: ${{ github.repository }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>context</span>: .
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>file</span>: ./Dockerfile
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>target</span>: final
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>push</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>tags</span>: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest
</span></span></code></pre></div><h2 id=lets-go-through-the-important-parts>Let’s go through the important parts:</h2><p><strong>Permissions</strong>: Actions have access to the repo while running. We should always make sure by setting the permissions, that actions have the minimum access they require. See here: <a href=https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token>permissions for the github_token</a></p><p><strong>Step 1-2: Checkout the code</strong> and Setup docker**</p><p><strong>Step 3: Login to GitHub Container Registry</strong>: This is where the interesting part starts. The <code>github.actor</code> that will be the user that triggered the workflow. For password use <code>secrets.GITHUB_TOKEN</code> which is a temporary token which is automatically generated for this workflow. See here: <a href=https://docs.github.com/en/actions/publishing-packages/publishing-docker-images#publishing-images-to-github-packages>publishing images to github-packages</a></p><p><strong>Step 4: Build and push Docker images</strong>: If the registry that you want to push to belongs to an organization then you will need to add permission to create packages.
If it lives under your own handle you don&rsquo;t need to configure anything more since you are then the owner already and the <code>secrets.GITHUB_TOKEN</code> has all the permissions granted by that.</p><p>Straight forward the action will consume the <code>Dockerfile</code> build to the target build step that you can define. In docker there is this thing that the repository whre the image will be hosted is also part of the tag. Setting the image to the repository name will create an image with the following tag: `ghcr.io/OWNER/IMAGE_NAME:latest
Read more here: <a href=https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#pushing-container-images>pushing container images</a></p><h2 id=happy-shipping-o>Happy shipping \o/</h2></div></article><hr><p class=articleTagsContainer><span></span>
<strong>Tags:</strong>
<a href=/tags/cd>#cd</a>
<a href=/tags/docker>#docker</a>
<a href=/tags/github>#github</a>
<a href=/tags/github-actions>#github-actions</a>
<a href=/tags/github-packages>#github-packages</a></p><a style=margin-bottom:24px;display:inline-block class=shareBtn onclick=openFediInstanceDialog()>Share on the Fediverse</a><div id=fediInstanceDialog><div class=bg onclick=closeFediInstanceDialog()></div><div class=dialog><h2>Enter your instance's address</h2><input id=fediInstanceInput placeholder='Eg. mastodon.social' type=text><div class=buttons><a class=shareBtn onclick=closeFediInstanceDialog()>Cancel</a>
<a class=shareBtn onclick=shareOnFedi()>Share</a></div></div></div><script>var articleTitle="Build and push docker images to ghcr.io with GitHub Actions",articleLink="https://dazz.github.io/posts/2022-12-28_build-and-push-docker-images-to-ghcr-with-github-actions/",fediInstanceDialog=document.getElementById("fediInstanceDialog"),fediInstanceInput=document.getElementById("fediInstanceInput");function openFediInstanceDialog(){fediInstanceDialog.classList.add("open")}function closeFediInstanceDialog(){fediInstanceDialog.classList.remove("open")}function fixURL(e){return e.substr(0,8)=="https://"?e:e.substr(0,7)=="http://"?e:"https://"+e}function shareOnFedi(){let e=fediInstanceInput.value.trim();if(!e)return;e=fixURL(e),window.open(`${e}/share?text=${articleTitle}%20${articleLink}`,"__blank"),closeFediInstanceDialog()}</script><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><div id=ficurinia-cactus-comments></div><script>initComments({node:document.getElementById("ficurinia-cactus-comments"),defaultHomeserverUrl:"https://matrix.cactus.chat:8448",serverName:"cactus.chat",siteName:"gabmus.org",commentSectionId:"16f5ed460c26090c806fa77c96a97a76"})</script><div class=relatedArticlesContainer><hr><h2>More posts like this</h2><div class=postlist><article class="card postlistitem"><div><h2><a href=https://dazz.github.io/posts/2022-12-27_goodbye-jekyl-hello-hugo/>Goodbye Jekyll, hello Hugo</a></h2><p class=date><span title=Date></span>
2022-12-27
|
<span title=Tags></span>
<a href=/tags/blog>#blog</a>
<a href=/tags/cd>#cd</a>
<a href=/tags/git>#git</a>
<a href=/tags/github>#github</a>
<a href=/tags/github-actions>#github-actions</a>
<a href=/tags/hugo>#hugo</a>
<a href=/tags/jekyll>#jekyll</a></p><a class=unstyledLink href=https://dazz.github.io/posts/2022-12-27_goodbye-jekyl-hello-hugo/><img src=https://dazz.github.io/posts/2022-12-27_goodbye-jekyl-hello-hugo//hugo.png alt></a><div class=articlePreview><p>I started this blog in March 2013 when I was working for ImagineEasy when I had a few ideas to write down on how I&rsquo;d work with Doctrine Repositories. I still like the idea, but I&rsquo;d probably do it a bit different today.</p><p><a href=https://dazz.github.io/posts/2022-12-27_goodbye-jekyl-hello-hugo/>Continue reading </a></p></div></div><hr></article></div></div></main><footer><hr><p><small>2022 &copy; dazz - <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></p><p><small><a href=https://gitlab.com/gabmus/hugo-ficurinia>Ficurinia theme</a> for <a href=https://gohugo.io>Hugo</a> by <a href=https://gabmus.org>Gabriele Musco</a>. Licensed under <a href=https://www.gnu.org/licenses/agpl-3.0.html>GNU AGPLv3</a>.</small></p></footer></div></div></div></body></html>