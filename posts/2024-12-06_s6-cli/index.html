<!doctype html><html lang=en-us><head><meta name=robots content="noai, noimageai"><meta name=viewport content="width=device-width"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=7"><link rel=icon href=/favicon.png><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=icon href=/logo.svg type=image/svg+xml><title>Manage s6-overlay setup with s6-cli &ndash;
DazzLog</title><link href=/symbols-nerd-font/symbols-nerd-font.css rel=stylesheet><link href=/jetbrains-mono/jetbrains-mono.css rel=stylesheet><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><link type=text/css rel=stylesheet href=https://blog.dazzlog.de/css/styles.1f262b17386856e8e4140b026646338b79e747bc3b05c355c2332e4a2a354a11b660e7c932b6078715838dc9e67aab7d8b761bd935d2946f3dcc62129e29ab21.css integrity="sha512-HyYrFzhoVujkFAsCZkYzi3nnR7w7BcNVwjMuSio1ShG2YOfJMrYHhxWDjcnmeqt9i3Yb2TXSlG89zGISnimrIQ=="><link type=text/css rel=stylesheet href=https://blog.dazzlog.de/css/admonition.b96f1a7df9789120ac45fb9c21858b542016295476d737d858978eb00a2922cf562bd9f9e33cf74d71f40248259678c1ba16082bb0ac996b715a938a50b3bec6.css integrity="sha512-uW8affl4kSCsRfucIYWLVCAWKVR21zfYWJeOsAopIs9WK9n54zz3TXH0AkgllnjBuhYIK7CsmWtxWpOKULO+xg=="><link type=text/css rel=stylesheet href=https://blog.dazzlog.de/css/custom.9e1918376e854b03e8b73b155f5d6904182d1db4cdd909cedb995c7e3f2f7d8a2cbe5a9577224365140198b0e84e49e0cd771afd76ad64d3fc54e3bd36acea5d.css integrity="sha512-nhkYN26FSwPotzsVX11pBBgtHbTN2QnO25lcfj8vfYosvlqVdyJDZRQBmLDoTkngzXca/XatZNP8VOO9NqzqXQ=="><meta name=author content="dazz | Anne-Julia Seitz"><meta name=keywords content='ci,devops,docker,s6-overlay'><meta name=description content='ll cli in golang to ease creating, validating and documenting services that s6 supervises.</p>
<ul>
<li>The repo: <a href="https://github.com/dazz/s6-cli">https://github.com/dazz/s6-cli</a></li>
<li>The docker image: <a href="https://hub.docker.com/repository/docker/hakindazz/s6-cli">https://hub.docker.com/repository/docker/hakindazz/s6-cli</a></li>
</ul>
<h2 id="usage">Usage</h2>
<p>You do not need to install anything, just execute the binary via docker</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -it --rm hakindazz/s6-cli <span style="color:#8be9fd;font-style:italic">help</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>COMMANDS:
</span></span><span style="display:flex;"><span>   create, c   create a service
</span></span><span style="display:flex;"><span>   remove, rm  remove a service
</span></span><span style="display:flex;"><span>   lint, l     lint directories and files
</span></span><span style="display:flex;"><span>   mermaid, m  document s6 service dependencies in mermaid syntax
</span></span><span style="display:flex;"><span>   help, h     Shows a list of commands or <span style="color:#8be9fd;font-style:italic">help</span> <span style="color:#ff79c6">for</span> one <span style="color:#8be9fd;font-style:italic">command</span>
</span></span></code></pre></div><h2 id="create-a-service-with-s6-cli">Create a service with s6-cli</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -it --rm -v ./:/etc/s6-overlay hakindazz/s6-cli create oneshot init-dependencies
</span></span></code></pre></div><p>Here is the file / directory structure it creates:</p>'><meta property="og:site_name" content='DazzLog'><meta property="og:title" content="Manage s6-overlay setup with s6-cli"><meta property="og:type" content="article"><meta property="article:author" content="dazz | Anne-Julia Seitz"><meta property="article:published_time" content='2024-12-06T23:42:23Z+0100'><meta property="article:tag" content="ci"><meta property="article:tag" content="devops"><meta property="article:tag" content="docker"><meta property="article:tag" content="s6-overlay"><meta property="og:url" content="https://blog.dazzlog.de/posts/2024-12-06_s6-cli/"><meta property="og:image" content="https://blog.dazzlog.de/posts/2024-12-06_s6-cli//s6-cli.webp"><meta property="og:description" content='<p>I developed a small cli in golang to ease creating, validating and documenting services that s6 supervises.</p>
<ul>
<li>The repo: <a href="https://github.co'><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content='blog.dazzlog.de'><meta property="twitter:url" content="https://blog.dazzlog.de/posts/2024-12-06_s6-cli/"><meta name=twitter:title content="Manage s6-overlay setup with s6-cli"><meta name=twitter:image content="https://blog.dazzlog.de/posts/2024-12-06_s6-cli//s6-cli.webp"><meta name=twitter:description content='<p>I developed a small cli in golang to ease creating, validating and documenting services that s6 supervises.</p>
<ul>
<li>The repo: <a href="https://github.co'><link rel=manifest href=/manifest/index.json></head><body><div id=baseContainer><header><div class=titleAndSearchContainer><div id=titleContainer><a class=unstyledLink href=/><img src=/logo.svg alt=Logo></a><div class=rightOfLogo><div class=titleAndHamburger><h1><a class=unstyledLink href=/>DazzLog</a></h1><label id=hamburger-menu for=main-nav-toggler>&#xf85b;</label></div><div id=wide_nav><nav><input type=checkbox id=main-nav-toggler><ul id=main-nav><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/talks>Talks</a></li><li><a href=/about>About</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></div></div><div class=search><input id=searchbar type=text placeholder=Search>
<span class=nerdlink onclick=newSearch()>&#xf002;</span></div><script>function newSearch(){let e=searchbar.value.trim();if(!e)return;location.href=`/search/?q=${e}`}searchbar.onkeyup=e=>{e.keyCode==13&&newSearch()}</script></div><div id=links><a rel=noreferrer target=_blank class=nerdlink href=/index.xml>&#xf09e;
<span>RSS
</span></a><a rel=noreferrer target=_blank class=nerdlink href=https://github.com/dazz>&#xf09b;
<span>GitHub
</span></a><a rel=me target=_blank class=nerdlink href=https://phpc.social/@dazz><svg class="pseudofont" width="16" height="16" viewbox="0 0 16 16"><path d="M7.4779094-.1598624e-5C5.5602384.0156984 3.7155894.2233384 2.6405814.7170384c0 0-2.13206093.9537-2.13206093 4.20766.0.74512-.01448 1.63603.0091 2.58084.07742 3.1821946.58336693 6.3183886 3.52553593 7.0971276 1.356568.359063 2.521335.434289 3.45936.382729 1.701085-.09431 2.6560206-.607063 2.6560206-.607063l-.05611-1.234252s-1.2156316.383272-2.5808476.33656c-1.352609-.04639-2.780561-.145832-2.999328-1.80651-.0202-.145872-.03031-.301902-.03031-.465714.0-1e-6 1.327834.324572 3.010574.40167 1.028943.0472 1.993827-.06028 2.9738766-.177218 1.879445-.224425 3.515901-1.382448 3.721577-2.4405646.32407-1.666815.297376-4.067605.297376-4.067605.0-3.25396-2.131943-4.20766-2.131943-4.20766C11.288476.2233384 9.4426784.0156784 7.5250084-.1598624e-5zM5.3076104 2.5424984c.798781.0 1.403595.30701 1.803551.92113l.388886.65181.388884-.65181c.399875-.61412 1.00469-.92113 1.803551-.92113.6903266.0 1.2465526.24267 1.6713186.71609.411755.47342.61677 1.11337.61677 1.91862v3.939988h-1.560986v-3.824218c0-.80613-.339166-1.21531-1.0176126-1.21531-.750129.0-1.126049.48533-1.126049 1.44509v2.09324h-1.551753v-2.09324c0-.95976-.376039-1.44509-1.126168-1.44509-.678446.0-1.017613.40918-1.017613 1.21531v3.824218h-1.560985v-3.939988c0-.80525.205053-1.4452.616889-1.91862.424685-.47342.980911-.71609 1.671317-.71609z"/></svg>
<span>Mastodon</span></a></div></header><div id=contentContainer><div id=content><main><article class="card single"><h1>Manage s6-overlay setup with s6-cli</h1><p class=date><span title=Date>󰃭 </span>2024-12-06</p><figure style=margin:0><img src=https://blog.dazzlog.de/posts/2024-12-06_s6-cli//s6-cli.webp alt></figure><div class=articleToc><nav id=TableOfContents><ul><li><a href=#usage>Usage</a></li><li><a href=#create-a-service-with-s6-cli>Create a service with s6-cli</a></li><li><a href=#use-s6-cli-in-your-ci>Use s6-cli in your CI</a></li><li><a href=#document-your-setup-with-mermaid>Document your setup with mermaid</a></li></ul></nav><hr></div><div><p>I developed a small cli in golang to ease creating, validating and documenting services that s6 supervises.</p><ul><li>The repo: <a href=https://github.com/dazz/s6-cli>https://github.com/dazz/s6-cli</a></li><li>The docker image: <a href=https://hub.docker.com/repository/docker/hakindazz/s6-cli>https://hub.docker.com/repository/docker/hakindazz/s6-cli</a></li></ul><h2 id=usage>Usage</h2><p>You do not need to install anything, just execute the binary via docker</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm hakindazz/s6-cli <span style=color:#8be9fd;font-style:italic>help</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>COMMANDS:
</span></span><span style=display:flex><span>   create, c   create a service
</span></span><span style=display:flex><span>   remove, rm  remove a service
</span></span><span style=display:flex><span>   lint, l     lint directories and files
</span></span><span style=display:flex><span>   mermaid, m  document s6 service dependencies in mermaid syntax
</span></span><span style=display:flex><span>   help, h     Shows a list of commands or <span style=color:#8be9fd;font-style:italic>help</span> <span style=color:#ff79c6>for</span> one <span style=color:#8be9fd;font-style:italic>command</span>
</span></span></code></pre></div><h2 id=create-a-service-with-s6-cli>Create a service with s6-cli</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm -v ./:/etc/s6-overlay hakindazz/s6-cli create oneshot init-dependencies
</span></span></code></pre></div><p>Here is the file / directory structure it creates:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>/etc/s6-overlay/s6-rc.d
</span></span><span style=display:flex><span>├── init-dependencies
</span></span><span style=display:flex><span>│   ├── dependencies.d
</span></span><span style=display:flex><span>│   │    ├── base
</span></span><span style=display:flex><span>│   │    └── svc-php-fpm
</span></span><span style=display:flex><span>│   ├── <span style=color:#8be9fd;font-style:italic>type</span>
</span></span><span style=display:flex><span>│   └── up
</span></span><span style=display:flex><span>└── scripts
</span></span><span style=display:flex><span>        └── init-dependencies
</span></span></code></pre></div><ul><li>The <code>base</code> dependency is added by <code>s6-cli</code></li><li>Adding <code>base</code> as default dependency tells s6-rc to only start a service when all the base services are ready, and it prevents race conditions</li></ul><h2 id=use-s6-cli-in-your-ci>Use s6-cli in your CI</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm -v .:/etc/s6-overlay hakindazz/s6-cli lint
</span></span></code></pre></div><p>It will tell you when it does not find any issue</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>s6-cli: lint found no issues
</span></span></code></pre></div><p>Or list the findings so you can fix them before you deploy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>s6-cli: lint found issues with services in /etc/s6-overlay/s6-rc.d
</span></span><span style=display:flex><span>- svc-lint-me
</span></span><span style=display:flex><span>  - <span style=color:#8be9fd;font-style:italic>type</span> file <span style=color:#ff79c6>for</span> <span style=color:#f1fa8c>&#34;svc-lint-me&#34;</span> does not end with a newline
</span></span><span style=display:flex><span>  - invalid <span style=color:#8be9fd;font-style:italic>type</span> in svc-lint-me/type file specified
</span></span></code></pre></div><h2 id=document-your-setup-with-mermaid>Document your setup with mermaid</h2><p>You can use the <code>mermaid</code> command to output the dependency graph between the services:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -it --rm -v .:/etc/s6-overlay hakindazz/s6-cli mermaid
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>```mermaid
</span></span><span style=display:flex><span>graph TD;
</span></span><span style=display:flex><span>    user --&gt; init-dependencies
</span></span><span style=display:flex><span>    user --&gt; init-migrations
</span></span><span style=display:flex><span>    user --&gt; svc-nginx
</span></span><span style=display:flex><span>    init-migrations --&gt; init-directories
</span></span><span style=display:flex><span>    svc-php-fpm --&gt; init-directories
</span></span><span style=display:flex><span>    svc-nginx --&gt; init-nginx
</span></span><span style=display:flex><span>    svc-nginx --&gt; svc-php-fpm
</span></span></code></pre></div><p>Which will result in this mermaid</p><div class=mermaid>graph TD;
user --> init-dependencies
user --> init-migrations
user --> svc-nginx
init-migrations --> init-directories
svc-php-fpm --> init-directories
svc-nginx --> init-nginx
svc-nginx --> svc-php-fpm</div><script type=module>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true, theme: "dark" });
</script></div></article><p class=articleTagsContainer><span> </span><strong>Tags:</strong>
<a href=/tags/ci/>#ci</a>
<a href=/tags/devops/>#devops</a>
<a href=/tags/docker/>#docker</a>
<a href=/tags/s6-overlay/>#s6-overlay</a></p><a style=margin-bottom:24px;display:inline-block class=shareBtn onclick=openFediInstanceDialog()>Share on the Fediverse</a><div id=fediInstanceDialog><div class=bg onclick=closeFediInstanceDialog()></div><div class=dialog><h2>Enter your instance's address</h2><input id=fediInstanceInput placeholder='Eg. mastodon.social' type=text><div class=buttons><a class=shareBtn onclick=closeFediInstanceDialog()>Cancel</a>
<a class=shareBtn onclick=shareOnFedi()>Share</a></div></div></div><script>var articleTitle="Manage s6-overlay setup with s6-cli",articleLink="https://blog.dazzlog.de/posts/2024-12-06_s6-cli/",fediInstanceDialog=document.getElementById("fediInstanceDialog"),fediInstanceInput=document.getElementById("fediInstanceInput");function openFediInstanceDialog(){fediInstanceDialog.classList.add("open")}function closeFediInstanceDialog(){fediInstanceDialog.classList.remove("open")}function fixURL(e){return e.substr(0,8)=="https://"?e:e.substr(0,7)=="http://"?e:"https://"+e}function shareOnFedi(){let e=fediInstanceInput.value.trim();if(!e)return;e=fixURL(e),window.open(`${e}/share?text=${articleTitle}%20${articleLink}`,"__blank"),closeFediInstanceDialog()}</script><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><div id=ficurinia-cactus-comments></div><script>initComments({node:document.getElementById("ficurinia-cactus-comments"),defaultHomeserverUrl:"https://matrix.cactus.chat:8448",serverName:"cactus.chat",siteName:"dazzlog",commentSectionId:"a51094677f529cdecb124fbe4486a88e"})</script><div class=relatedArticlesContainer><hr><h2>More posts like this</h2><div class=postlist><article class="card postlistitem"><div><h2><a href=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container/>Mastering Multi-Process Containers: Running PHP Applications with s6-overlay</a></h2><p class=date><span title=Date>󰃭 </span>2025-03-26
|
<span title=Tags> </span><a href=/tags/ci>#ci</a>
<a href=/tags/devops>#devops</a>
<a href=/tags/docker>#docker</a>
<a href=/tags/s6-overlay>#s6-overlay</a></p><a class=unstyledLink href=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container/><img src=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container//multi-process-container.webp alt></a><div class=articlePreview><p><h2 id=the-dockerized-development-setup>The Dockerized Development Setup</h2><p>Containerization has completely changed how we build and deploy PHP applications. With Docker, you can make sure that your production environment behaves just like your local setup, which means fewer surprises when you go live.</p><p>In this post, we&rsquo;re diving into running Symfony in a container that runs multiple processes using s6-overlay. We&rsquo;ll explain why having more than one process in a container can be important, how this idea is different from Docker&rsquo;s usual “one process per container” rule, and how s6-overlay makes it easier to run everything together.</p></p><p><a href=https://blog.dazzlog.de/posts/2025-03-26_running-php-in-a-multi-process-container/>Continue reading </a></p></div></div><hr></article><article class="card postlistitem"><div><h2><a href=https://blog.dazzlog.de/posts/2024-08-19_base-image-with-s6-overlay/>Build your own s6-overlay base image</a></h2><p class=date><span title=Date>󰃭 </span>2024-08-19
|
<span title=Tags> </span><a href=/tags/devops>#devops</a>
<a href=/tags/docker>#docker</a>
<a href=/tags/s6-overlay>#s6-overlay</a></p><a class=unstyledLink href=https://blog.dazzlog.de/posts/2024-08-19_base-image-with-s6-overlay/><img src=https://blog.dazzlog.de/posts/2024-08-19_base-image-with-s6-overlay//s6-overlay.webp alt></a><div class=articlePreview><p><p>S6-overlay is a container-focused process manager that offers end-to-end management of the container&rsquo;s lifecycle, from initialization to graceful shutdown.</p><p>To make use of s6-overlay we need to add the binaries to our container by adding, extracting and then moving them to the directory where they are expected.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#ff79c6>ADD</span> https://github.com/just-containers/s6-overlay/releases/download/3.2.0.0/s6-overlay-noarch.tar.xz /tmp  
</span></span><span style=display:flex><span><span style=color:#ff79c6>ADD</span> https://github.com/just-containers/s6-overlay/releases/download/3.2.0.0/s6-overlay-x86_64.tar.xz /tmp
</span></span></code></pre></div><h2 id=update-dependencies>Update dependencies</h2><p>When adding the s6-overlay sources to in a <code>Dockerfile</code> we want to make sure that we get notified when a new version
is available, so we can always be up-to-date with all our libraries. This can be achieved by adding a section to our <a href=https://github.com/renovatebot/renovate>Renovate</a> or <a href=https://github.com/dependabot>Dependabot</a> config, a rule to match</p></p><p><a href=https://blog.dazzlog.de/posts/2024-08-19_base-image-with-s6-overlay/>Continue reading </a></p></div></div><hr></article></div></div></main><footer><hr><div class=footerColumns><ul class=notlist><li><strong>this.site</strong></li><li><a target=_blank href=/about>about</a></li><li><a target=_blank href=/impressum>impressum</a></li></ul><ul class=notlist><li><strong>self.dazz</strong></li><li><a target=_blank href=https://github.com/dazz>my GitHub</a></li><li><a target=_blank href=https://medium.com/@dazs>on Medium</a></li><li><a target=_blank href=https://speakerdeck.com/dazz/>Speaker Deck</a></li></ul><ul class=notlist><li><strong>here.links</strong></li><li><a target=_blank href=https://c-base.org>c-base</a></li></ul></div><p><small>2026 &copy; dazz - <a href=https://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License</a>.</small></p><p><small><a href=https://gitlab.com/gabmus/hugo-ficurinia>Ficurinia theme</a> for <a href=https://gohugo.io>Hugo</a> by <a href=https://gabmus.org>Gabriele Musco</a>. Licensed under <a href=https://www.gnu.org/licenses/agpl-3.0.html>GNU AGPLv3</a>.</small></p></footer></div></div></div></body></html>